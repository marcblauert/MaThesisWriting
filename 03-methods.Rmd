<!--
Chapter 3 - Methods
-->

```{r setup3, echo=FALSE}
pacman::p_load(tidyverse, thesisdown, knitr, kableExtra)

# Set how wide the R output will go
options(width = 70)
```


# Methods {#methods}

## Data Description and Pre-Processing {#data}

To translate the conceptual model set up in Chapter \@ref(conceptual-model) into a statistical model that can be used to empirically investigate the price elasticity of space heating demand, data from multiple sources were combined. In the following, the variables and the pre-processing of the data are presented. An overview of all variables and their respective data source is given in Table \@ref(tab:variables). First, the focus is on the energy billing dataset and its variables and then on variables retrieved from supplementary data sources.

**Energy billing dataset**

The key dataset is a large-scale building-level sample of energy bills made available through the Climate Policy Department at DIW Berlin. The data originates from the energy- and billing service provider ista Deutschland GmbH and was provided for scientific use.[^31]

[^31]: The billing data is classified as sensitive. Access was made available via DIW Berlin's internal servers. For data protection reasons, it is not possible to make the data available to external parties for the purpose of reproducing the results.

The sample contains almost 4.5 million annual billing observations for multi-apartment residential buildings in Germany between 2003 and 2019. Since ista first included energy prices in the sample in 2007, the period under study ranges between 2007 and 2019. The smallest buildings observed in the sample are buildings with two apartments. Single-family houses are not observed. The observations in the dataset represent annual heating bills at the building level. Most importantly, the billing dataset provides the two core variables for the analysis: space heating demand and energy prices. In addition, the sample also provides other variables relevant for the analysis, such as the building heating surface, the type of energy carrier used within a billing period, and a building ID and the billing dates, which are suitable for creating a panel structure.[^3008]

[^3008]: It should be noted that DIW Berlin also has an additional dataset with information from Energy Performance Certificates (EPC) on a subset of the buildings in the billing dataset. In the preparatory phase, the idea was to use additional information from the EPC dataset in the analysis. However, since the data was only available for about 15% of the observations in the billing dataset and the data systematically favoured larger buildings, the idea was ultimately abandoned. However, the pre-processing steps on the EPC data are preserved in the repository on GitHub and may be used by the DIW Climate Policy Department for further analyses.

**Space heat demand (kWh/sqm/y):** The demand data in the billing dataset is provided as total energy consumed per building and per annual billing period in kilowatt-hours (kWh). In order to isolate the share of energy consumed for space heating, the share of energy consumed for hot water generation is deduced for those buildings in which the central heating system also provides hot water. In a second step, the total space heating demand at the building level is divided by the heating surface in square meters (sqm) to obtain a comparable metric for the differently sized buildings in the sample. This results in the annual space heat demand per square meter as the demand variable (kWh/sqm/y).

**Energy prices (Cents/kWh):** The energy price data is provided as total annual costs for the heating system at the building level in Euros. Typically, residential energy contracts for gas and district heating in Germany involve a fixed cost component (flat-rate basic charge) and a variable cost component (demand-based price per kWh).[^33] Buildings with oil heating, on the contrary, mainly incur variable costs for heating oil deliveries. Unfortunately, a breakdown of fixed and variable costs is not provided. Again, relying on the supplementary information on relative shares of energy use for the two purposes of space heating and hot water generation in buildings where hot water is generated by the central heating system, the cost share for space heating can be isolated. In a second step, the metric is then translated into an average per-unit price by dividing the building level expenditures for space heating by the respective demand for space heating in kWh. Since energy prices are provided as nominal values, it is necessary to adjust them for inflation. The nominal energy prices are deflated using the German annual consumer price index (CPI), with 2015 as the index year [@destatis21]. The use of the CPI to deflate energy prices represents the standard procedure in the literature [e.g., @schmitz_madlener20]. The real energy price per-unit (Cents/kWh) is the variable used in the analysis.

There is much debate in the literature about whether the energy demand response depends on the average or the marginal price of energy, with the average price being the more common approach in most literature [e.g., @metcalf_hassett99; @rehdanz07; @schmitz_madlener20]. The use of marginal prices becomes necessary when the utility provider dynamically adjusts the variable price component based on the quantity consumed (*block pricing*) or at a higher frequency based on market prices, as is the case, for example, with many residential contracts in the US [see @auffhammer_rubin18]. But since those factors do not apply to residential energy contracts in Germany, I assume the use of the average per-unit energy price to be a reasonable approach even though the relative shares for the fixed and the variable cost component remain unknown.

[^33]: Based on example heating bills provided by ista, it was possible to establish that this was also the case for the buildings in the billing sample.

**(Billing) Year:** The billing data also contains the exact dates of the billing period of an individual building. While for most observations, the billing period reflects the calendar year, some buildings have billing periods that are split over two years. Therefore, the start and end dates are used to assign these observations to years. The criterion is which of the two years counts the majority of days.

**Energy carrier group:** There are three main types of energy carriers included in the dataset: Gas, oil, and district heating. To arrive at the three groups, the energy carrier descriptions from the dataset are allocated to the groups (e.g., *Gas low* and *Gas high* are grouped under *Gas*). All additional heating carriers which have only limited occurrence in the sample (e.g., electricity for heat pumps, coal) are grouped under the category *Others* but not considered further in the analysis due to the small number of observations and difference between the carrier types within the group (see Chapter \@ref(workflow-empirical-approach)).

**Heating surface (sqm):** Information on the heating surface of a building is given in square meters at the building level. The heating surface does not correspond to the total floor area of a building, as it excludes the unheated surface areas within a building (e.g., corridors or basements). The heating surface area was preferred to the number of apartments within a building in order to approximate the size of a building. The reason for this is that the heating surface area better reflects the relationship between the indoor and outdoor surface area of a building, as it does not suffer in its accuracy from the different apartment sizes between individual buildings.

\begin{table}[]
\centering
\caption{Variables and data sources}
\label{tab:variables}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}lllll@{}}
\toprule
\textbf{Variable} & \textbf{} & \textbf{Type of variable} & \textbf{Unit} & \textbf{Data source} \\ \midrule
 &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Demand\\ \end{tabular}} & Space heating demand & Continuous & ln(kWh/sqm/y) & Ista (billing dataset) \\
\textit{} &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Price\\ \end{tabular}} & (Average) Energy price, real & Continuous & ln(Cents/kWh) & Ista (billing dataset), DESTATIS (2021b)\\
\textit{} &  &  &  &  \\
\multirow{4}{*}{\textit{\begin{tabular}[c]{@{}l@{}}Additional billing \\information\\ \end{tabular}}} & Heating surface & Continuous & ln(sqm) & Ista (billing dataset)\\
 & Energy carrier group & Categorical & Gas / Oil / District heating & Ista (billing dataset)\\
 & Building ID & Categorical & - & Ista (billing dataset)\\
 & Year & Categorical & - & Ista (billing dataset)\\
\textit{} &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Climatic conditions\\ \end{tabular}} & Degree days & Continuous & ln(Degree days) & IWU (2021) \\
\textit{} &  &  &  &  \\
\multirow{3}{*}{\textit{\begin{tabular}[c]{@{}l@{}}Socio-economic factors\\ \end{tabular}}} &  District per capita household income & Continuous & ln(Euros/y) & Statistische Ämter (2021) \\
 & District retirement share & Continuous & \% & DESTATIS (2021a) \\
 & Postal code population density & Continuous & ln(Inhabitants/sq. km) & OSM (2021a), OSM (2021b) \\ \bottomrule
\end{tabular}%
}
\end{table}

\newline

**Variables from supplementary data sources**

**Degree days:** Data on degree days is retrieved from an Excel tool published by the *Institut für Wohnen und Umwelt (IWU)* at the postal code level [@iwu21]. The degree days data from the IWU tool builds on daily temperature data from the 800 weather stations of the German Meteorological Service (DWD) that are aggregated to monthly values. In the tool, the settings of a mean room temperature of 20°C and a heating limit of 15°C are chosen to reflect the VDI-based definition of degree days [@vdi13]. Furthermore, the option to assign the postal code area to the three nearest DWD weather stations with importance weighting according to geographical distance is chosen. Relying on more than one station reduces the risk of potential distortions from differences in altitude between a weather station and the centroid of a postal code area. The extracted monthly degree days data at the postal code level are then aggregated to annual periods on a rolling basis and allocated to the energy bills. The postal code level is used because it corresponds to the spatial information on the location of the buildings contained in the billing dataset and thus ensures the most accurate allocation possible.

**District per capita household income (Euros/y):**The per capita disposable income of private households provided by the joint statistics portal of the National Government and the Federal States is used as the income variable at the district level [@statistischeamter21]. The figure represents the primary income of private households, minus transfers paid plus transfers received. Disposable income is chosen because it can be considered the most suitable indicator for household funds available. The district level is chosen because it is the most granular household income statistics publicly available.

**District retirement share (%):** To construct the district retirement share variable, population data at the district level with segmentation by age groups is used [@destatis21c]. The percentage of persons 65 years of age and older is calculated to approximate the actual proportion of retirees. This approach was chosen because no detailed statistics are available on the number of people in retirement at the district level. The boundary value of 65 is chosen as the age group boundary most closely corresponds to the current retirement age in Germany. Furthermore, the same threshold is also used in the literature (e.g., @alberini_etal11).

**Postal code population density (Inhabitants/sq. km):** To generate the population density variable, data from Open Street Maps with pre-assigned population figures to postal code areas based on the 2011 Census are used [@osm21; @osm21a]. The postal code level is used because the higher granularity of data is available, and the use of population density at the more aggregate district level might obscure heterogeneity within districts. This is especially the case for districts that include cities and rural areas. To create the population density variable, the number of inhabitants per postal code area is divided by the base area in square kilometres ( sq. km), which gives the population density as the average number of inhabitants per sq. km in a postal code area.

## Empirical Considerations {#empirical-considerations}

**Causality with observational data**

The conceptual DAG presented in Chapter \@ref(conceptual-model) and the rationale derived for the cause-and-effect relationship between energy price and space heat demand in an environment where the other explanatory variables also exert an effect on energy demand are all based on the assumption of causal inference. Causal inference can be described as indicating that an observed relationship between two variables is reflected by a causal link and not just mere correlation [@holland86]. The analysis in this thesis is built on externally provided observational data. Using observational data to draw causal inference about a treatment effect -- in the given case, inference about the price sensitivity of private households for space heating demand -- is inherently difficult since the treatment is not controllable and therefore cannot be randomly assigned [@nichols07]. Since an experimental research design, which would arguably provide the most unbiased source of evidence, is not feasible for this type of research, it is all the more important to point out potential sources of bias in the estimation process and address those sources of bias where possible.

**Potential sources of bias**

Reducing potential sources of bias was approached in several steps. First, the previously described set of explanatory variables was used to minimise possible bias from omitted variables. This means that by taking into account, for example, degree days or the heating surface of a building, additional relevant effects on space heating demand are included that might otherwise be wrongly attributed to energy price. That being said, there is also a gap in the data related to omitted variables that cannot be fully remedied. Due to the aggregated nature of the billing dataset at the building level, it is impossible to integrate detailed household-level socio-economic variables (e.g., household income, number of inhabitants, age, education level, or employment status) into the analysis. In previous studies, which build on household-level social surveys, socio-economic variables have been found to be a relevant determinant of energy demand. In particular, household income is a variable for which a relevant effect has been pointed out [e.g., @meier_rehdanz10; @rehdanz07; @schmitz_madlener20]. To at least partially fill the gap of household-level socio-economic variables, this thesis employs district or postal code level socio-economic controls to attempt to capture the underlying socio-economic effects at a higher level of aggregation.

Besides omitted variables, errors in the data can be another source of potential bias. In general, using observational data, where the researcher was not involved in the data generation process, should not be seen as a mechanistic process but should be based on applying domain-specific knowledge to evaluate and scrutinise the available data critically. Applying domain-specific knowledge and expert judgement was important in cleaning and processing the energy billing dataset. When assessing the energy price variable from the billing dataset, outliers are found that can be traced back to represent placeholders that do not reflect the actual energy demand of a building. If these observations had not been removed from the analysis, they would have distorted the result of the analysis. The process is described in detail later in this Chapter.

In addition, it was assessed if the variables used in the analysis incorporated any systematic bias from their measurement. In principle, several variables are subject to inaccuracies in their measurement. For example, the degree days data is based on spatial interpolation of the values from the three nearest DWD weather stations to the centroid of a postal code area, which introduces a first layer of inaccuracy. It is then assumed that the degree days assigned to a postal code area apply to every building within that area, even though there may be greater distances and differences in elevation between the centroid and a building's exact location. However, inaccuracies in the measurement -- such as those described exemplarily for the degree days variable -- do not necessarily present a problem since they do not introduce a systematic error (bias). Instead, the described inaccuracies indicate a random effect, which is less severe in general and especially given the large number of observations present in the sample, as one may assume that inaccuracies in measurement can balance out.

**Simultaneity problem**

Furthermore, when estimating price elasticities of demand, one additional relevant challenge for the identification of a causal effect is the potential simultaneous determination of price and demand. If one assumed that demand and supply curves shift over time, the observed data on quantities and prices would reflect a set of equilibrium points on both curves [@angrist_krueger01]. The common approach in the economic literature to address the endogeneity steaming from simultaneity is to pursue an instrumental variable approach [@angrist_krueger01; @burtless_hausman78]. Using an instrumental variable approach was also explored for this thesis. In line with the strategy followed by @auffhammer_rubin18 to instrument for energy price, the use of the Trading Hub Europe (THE) Gas forward price was considered. However, this approach was ultimately discarded because the identifying assumption that the instrument (THE Gas forward price) needs to be highly correlated with the energy prices in the sample was not met. This is mainly because the prices observed in the billing sample are more scattered than average energy prices. However, unlike in the case of @auffhammer_rubin18 residential energy contracts in Germany are more regulated than in the US, where, for example, the rates faced by consumers change monthly -- updated as a function of gas wholesale prices paid by the retail utilities. So while not being able to pursue an instrumental variable approach remains an issue to potentially producing biased estimates, it appears to be a concern less salient with the data underlying this thesis.

## Workflow and Empirical Approach {#workflow-empirical-approach}

For the regression analysis, several statistical methods are used. First, an analysis of the full sample to estimate an overall price elasticity of demand is conducted. Given the large number of observations in the sample, this analysis relies on classical statistical methods. Subsequently,  the analysis is deepened based on a stratified random subsample. Here, Bayesian regression analysis is used to better communicate the uncertainty inherent to the estimates and to investigate potential factors for heterogeneity in the overall elasticity estimates. The general approach to designing an empirical model is first to construct a simple model and then expand it into a more complex statistical model. The aim is to arrive at a model with a good fit but also make the way to get to it transparent.

**Processing of billing sample and matching with supplementary data**

However, before one can perform the regression analysis, it is necessary to clean the energy billing dataset. This involves several steps, which are shown in the upper part of Figure \@ref(fig:workflow1). After the data cleaning, 2,718,246 of the original 4,494,943 annual billing observations (60.5%) remain for the regression analysis. The criteria used in the cleaning process are ordered by the number of observations removed and are described in the following.

The most important reason for exclusion from the sample is the absence of price data. Between 2003-2006, price data were unavailable for all observations. This leads to the exclusion of 909,458 observations. In addition, price data is also missing for some of the observations in the period 2009-2019. Due to these gaps in the price data, a further 543,544 observations are excluded from the dataset. Another 233,888 observations are removed from the sample because they are associated with buildings that occur only once in the sample. The decision to apply the criterion that buildings must occur at least twice in the sample is mainly due to the fact that singular building IDs occur primarily in the period 2007-2008, suggesting that IDs from this period are not always linked with observations in later years. In addition, observing a building at least twice allowed cross-validation through matching building attributes and thus better reliability of the data. Another 53,674 observations are removed from the sample because the buildings are heated with an energy carrier other than gas, oil, or district heating. Due to the small number of observations compared to the total sample size and due to the heterogeneity of the group (e.g., heat pumps but also coal heating), it was decided to exclude them. In addition, another 1,722 observations are excluded as duplicates (based on matching building ID and year) and 65 observations due to a deviating length of the billing period (deviation of more than +/- 10 days).

```{r workflow1, echo = FALSE, fig.cap = "Workflow for data processing and regression analysis based on full sample", out.width = "103%", fig.align = "center"}
knitr::include_graphics(path = "figure/workflow_diagramm_part1.pdf")
```

**Removal of outliers representing data errors in the energy price variable**

Besides the aspects described above, there are two additional reasons for excluding observations from the sample. Both are related to outliers in the energy price data. Conducting the analysis with and without these two cleaning steps showed that they can have a strong influence on the price elasticity estimates and are therefore highly relevant.

First, it was determined through exploratory, descriptive analysis of the price variable and confirmed by ista that the price data contains fictitious cost values (e.g., 1,000.00 Euros for the entire building) that are used as placeholders and do not reflect actual costs.[^3489] These fictitious cost values arise because ista, as a billing service provider, does not always have information about the costs incurred by the building owners and therefore uses the placeholders for internal technical reasons. The actual costs are only entered later by the building owners and therefore do not appear in the provided data. This practice leads to the formation of outliers in the energy price variable, as the fictitious cost values do not necessarily reflect the size and characteristics of a building. A total of 31,665 observations are removed from the sample due to fictitious cost values identified by searching for round cost rates without cent amounts that occur unusually often in the sample.

[^3489]: The internal practice of ista was confirmed on the basis of an email exchange for the Wärmemonitor 2019.

Second, despite removing the fictitious cost values, some substantial outliers remained in the price data. An exploratory review of individual cases revealed that the remaining price outliers were likely due to other types of data errors (e.g., unrealistic heating surfaces), which is not unusual given the large number of observations in the sample. Therefore, it was decided to also exclude the remaining observations that showed highly unrealistic deviations from the reasonable price level expected during the period under study (Real prices: <2 Cents/kWh or >100 Cents/kWh) or unrealistic price changes from one period to another (Change in real prices: >10 or < -10 Cents/kWh compared to the previous billing period). The exclusion thresholds are based on expert judgment and are chosen only to exclude highly implausible observations. The use of the described thresholds for absolute prices and relative price changes resulted in the exclusion of an additional 1,717 observations from the sample.

After scrutinising the reliability of the price variable, the processed billing dataset is then matched with the external data from supplementary sources (see Figure \@ref(fig:workflow1)). Due to missing degree days data and changes in the administrative areas, a further 2,964 observations are removed from the sample in this step, which ultimately leads to 2,718,246 observations remaining for the regression analysis.

**Empirical approach for analysis of full sample**

Given the large number of observations in the sample, I rely on classical statistical methods to conduct the analysis of the full sample. To begin with, I formulate a simple cross-sectional multiple linear regression (MLR) model based on ordinary least squares (OLS) [@bailey17; @wooldridge13]:

```{=tex}
\begin{align*}
ln(Demand) & = \alpha + \beta_1 \cdot ln(Price) + \beta_2 \cdot ln(Degree.days) + \\
 & \quad \beta_3 \cdot ln(Heating.surface) + \beta_{4} \cdot Carrier.group.oil + \\
 & \quad \beta_{5} \cdot Carrier.group.district.heating + \beta_{6} \cdot ln(District.income) + \\
 & \quad \beta_{7} \cdot District.retire + \beta_{8} \cdot ln(Pop.density) + \varepsilon 
\end{align*}
```

Where the response variable $ln(Demand)$ denotes the natural logarithm of the annual space heating demand per square meter, and the main explanatory variable $ln(Price)$ denotes the natural logarithm of the average energy price (Cents/kWh) in the same period. The additional terms on the right-hand side of the equation denote the additional explanatory variables (degree days, building characteristics, and district/postal code socio-economic variables). $\varepsilon$ denotes the error term of the model. Referring back to Equation \@ref(eq:demand2) in the theory section, the ln-form of both sides of the equation transforms the model into the elasticity case, meaning that the coefficient $\beta_1$ of $ln(Price)$ represents the price elasticity of space heating demand under the assumption that the elasticity is a constant factor. For the cross-sectional OLS regression, I first run the model with $ln(Price)$ as a sole predictor and then with the additional explanatory variables included. All model predictors except the energy carrier group, which is a categorical variable, and the district retirement share, which is already a ratio, are included in the ln-transformed form. This is done first to facilitate the interpretation of the results in the elasticity case and, secondly to reduce the impact of possible outliers in the distribution of the variables. The use of ln-transformed continuous predictors is also the standard approach in the previous literature [e.g., @auffhammer_rubin18; @meier_rehdanz10; @schmitz_madlener20].

In the billing dataset, it is possible to assign several observations to the same building (building ID) and year (billing period). Thus, the data structure allows to go beyond cross-sectional OLS and apply panel data estimation techniques. In the OLS estimation shown above, observations from various buildings and years are treated to be systematically no different from each other. Panel data methods, on the contrary, are rooted in the assumption that there may be systematic and unobserved differences between units that may be correlated with observed predictors whose effects on the response are to be measured [@wooldridge13]. Thus, panel data methods are considered a powerful tool for observational data, where controlling for all relevant factors is inherently difficult [@bailey17]. By acknowledging and addressing that there may be unobserved inter-individual differences between the units (buildings) and an intra-individual dynamic over time (years), the use of panel data methods can provide a more accurate picture of the predictors observed in the model.

For the given subject, the demand for space heating is likely impacted by various unobserved building-specific constant or semi-constant factors, such as a building's energetic condition or its usage properties. Thus, inferences drawn from cross-sectional data are likely invalid since building-specific effects are falsely attributed to the observed model predictors -- including energy price. The same applies to temporal trends. For example, new buildings with higher energy standards could be added to the sample throughout the period under investigation and old buildings might drop out of the sample due to demolition. Such factors, which affect the structural composition of the sample over time, may result in space heating demand in the later periods being systematically lower than that in the earlier periods. In the empirical literature, switching from a cross-sectional model to using unit-level effects with panel data methods typically resulted in more inelastic estimates for the price elasticity of space heating demand [@miller_alberini16].

In addition, the choice of panel estimation method should provide more reliable results even when strict exogeneity fails to hold. Therefore, I adopt a two-way fixed effects (FE) model, considered one of the more robust estimation methods and a commonly used approach in the prior literature on the price elasticity of space heating demand [e.g., @lange_etal14; @meier_rehdanz10; @schmitz_madlener20]. The FE model takes the following form:

```{=tex}
\begin{align*}
ln(Demand_{i,t}) & = \alpha + \beta_1 \cdot ln(Price_{i,t}) + \beta_2 \cdot ln(Degree.days_{i,t}) + \\
 & \quad \beta_3 \cdot ln(Heating.surface_{i,t}) + \beta_{4} \cdot Carrier.group.oil_{i,t} + \\
 & \quad \beta_{5} \cdot Carrier.group.district.heating_{i,t} + \beta_{6} \cdot ln(District.income_{i,t}) + \\
 & \quad \beta_{7} \cdot District.retire_{i,t} + \beta_{8} \cdot ln(Pop.density_{i,t}) + \\
 & \quad \gamma_{building[i]} + \delta_{year[t]} + \varepsilon_{i,t}
\end{align*}
```

The FE model structure extends the cross-sectional OLS model. The response variable $ln(Demand_{i,t})$ again denotes the natural logarithm of the annual space heating demand per square meter but is extended by the indices on building $i$ and the annual time period $t$. The same applies to $ln(Price_{i,t})$ as the average real energy price (Cents/kWh) and the set of additional explanatory variables. The newly added term $\gamma_{building[i]}$ denotes the time-invariant building fixed-effect and $\delta_{year[t]}$ the annual time fixed-effect. $\varepsilon_{i,t}$ again denotes the error term.

First, the model is run without the additional explanatory variables to obtain an estimate where only the energy price is used to explain demand. In a second Specification, the set of additional explanatory variables is then included. Additionally, variables with limited explanatory power are dropped in a third Specification to arrive at a more condensed and relevant model specification. Furthermore, I also run a model where $ln(Price_{i,t)}$ is substituted by $ln(Price_{i,t-1})$, so taking the lag of the price variable in $t-1$ instead of the price in the same period to explain the space heating demand in period $t$.

All the models described represent the conditional demand. It therefore has to be inferred that the results reflect the short-term price elasticities of demand. The application of other dynamic approaches to estimate long-term elasticities, as @alberini_etal11 or @csereklyei20 have done, was decided to go beyond the scope of this thesis and are therefore not pursued. Additionally, the short-term price elasticities estimated here may also be viewed as lower bound estimates of the price responsiveness compared to the usually higher long-term estimates.

To estimate the OLS models, I rely on the lm-function in R. To run the FE models, I use the felm-function from the lfe-package [@gaure2013lfe].

**Stratified subsampling and Bayesian regression analysis**

After using classical statistical estimation techniques on the full sample, the analysis moves to apply Bayesian regression analysis on a subsample of the data. In general, the use of Bayesian inference has the advantage of allowing for the propagation of uncertainty in the modelling process [@mcelreath20]. Furthermore, the Bayesian framework allows for a more intuitive interpretation of modelling results being the actual chance of an event happening rather than the probability that the same outcome would occur if one were to replicate the data [@mcelreath20]. A further advantage of Bayesian inference is the logic of updating beliefs based on evidence (data) and the potential integration of prior knowledge [@gelman_etal21]. However, here I refrain from making strong assumptions on the prior distribution of model parameters and instead rely on weakly informed priors because enough data is available. Additionally, it should be pointed out that Bayesian inference is more computationally demanding than the classical statistical methods presented above. This is why Bayesian inference is only used on a subsample and not for the analysis of the full sample.

```{r workflow2, echo = FALSE, fig.cap = "Workflow for stratified subsampling and Bayesian regression analysis based on subsample", out.width = "103%", fig.align = "center"}
knitr::include_graphics(path = "figure/workflow_diagramm_part2.pdf")
```

In Figure \@ref(fig:workflow2), the second part of the workflow is shown. The subsample is set up as a stratified random selection of 400 buildings per energy carrier group (Gas, Oil, District heating) from the full sample. The number of 400 buildings per energy carrier group is chosen because the sample will remain large enough to draw reliable inference and because running the more computationally demanding Bayesian models with the associated amount of observations is possible within a reasonable time. The subsample analysis intends to serve two purposes in delimitation to the full sample analysis. First, as mentioned in the previous paragraph, using fewer data points makes the application of Bayesian methods possible, which are well-suited to propagate uncertainty. Second, the subsample is used to investigate potential factors of heterogeneity in price responsiveness in the data, first resorting to exploitative visual analysis and then moving to construct an interaction term model. The stratified sampling approach, where all three energy carrier groups are represented equally, allows the investigation of the carrier type as a potential additional source of heterogeneity. Furthermore, having a stronger representation of district heating than in the main sample also allows for a glimpse into the future, where gas and oil heating systems will become less viable given the current gas energy crisis and rising carbon prices and will therefore be replaced by district heating (or heat pumps [^5278]).

[^5278]: Heat pumps are not considered here due to the still very limited data available on heat pump use in the billing sample.

For the analysis of the subsample, I first run simpler models that mirror the OLS Specifications for the full sample but in a Bayesian setting. When moving to the models integrating the grouping variables building ID and years, I use a multilevel (partial pooling) model with varying intercepts [@mcelreath20]. In contrast to the FE models used for the full sample analysis, where only information from the same units (buildings and years) is considered, multilevel models with varying intercepts allow for information sharing between units [@mcelreath20]. The use of clusters without information sharing may lead to less reliable estimates, especially if only a few observations are available for a building. Together with the weakly informed priors mentioned earlier, the main model Specification with the multilevel (partial pooling) structure with varying intercepts takes the following form:

```{=tex}
\begin{align*}
ln(Demand_{i,t}) & \sim \operatorname{Normal}(\mu_{i,t}, \sigma) \\
\mu_{i,t} & \sim \bar\alpha + \gamma_{building[i]} + \delta_{year[t]} + \beta_1 \cdot ln(Price_{i,t}) +  \\
 & \quad \beta_{2} \cdot ln(Degree.days_{i,t}) + \beta_{3} \cdot ln(Heating.surface_{i,t}) + \\
 & \quad \beta_{4} \cdot Carrier.group.oil_{i,t} + \beta_{5} \cdot Carrier.group.district.heating_{i,t} + \\
 & \quad \beta_{6} \cdot ln(District.income_{i,t}) + \beta_{7} \cdot District.retire_{i,t} + \beta_{8} \cdot ln(Pop.density_{i,t}) \\
\bar\alpha & \sim \operatorname{Normal}(0, 1) \\
\gamma_j & \sim \operatorname{Normal}(0, \sigma_{\gamma}) \\
\delta_k & \sim \operatorname{Normal}(0, \sigma_{\delta}) \\
\beta_{1-8} & \sim \operatorname{Normal}(0, 0.5) \\
\sigma, \sigma_{\gamma}, \sigma_{\delta} & \sim \operatorname{Exponential}(1)
\end{align*}
```

Where, again, the response variable $ln(Demand_{i,t})$ denotes the natural logarithm of the annual space heating demand per square meter in building $i$ in the year $t$, and the main explanatory variable $ln(Price_{i,t})$ denotes the natural logarithm of the average energy price (Cents/kWh) in the same period. The intercept term ($\bar \alpha$) denotes the varying intercepts along the two grouping variables buildings ($\gamma_{building[i]}$) and years ($\delta_{year[t]}$). For the model, it is assumed that all parameters follow a Gaussian distribution centred on 0. The intercept term $\bar \alpha$ is assumed to have a standard deviation of 1. The distribution parameter $\sigma$, as well as the parameters $\sigma_{\gamma}$ and $\sigma_{\delta}$ for the varying intercepts, were assumed to follow an $Exp(1)$ distribution so that they are limited to the positive values which are required to represent the standard deviation.

**Investigation of heterogeneity in price responsiveness**

The subsample analysis is also concerned with identifying potential sources of heterogeneity in the price responsiveness that may remain hidden when only estimating an overall price elasticity of demand. To this end, a two-step approach is adopted (see Figure \@ref(fig:workflow2)). First, scatter plots between energy price and demand, grouped by a third variable, are used to visually investigate whether one can find relevant differences in price responsiveness within a set of explanatory variables. In a second step, the heterogeneity found for the energy carrier group variable is then formalised by extending the Bayesian multilevel model with varying intercepts with an interaction term between energy price and the energy carrier group. This extended interaction model takes the following form:

```{=tex}
\begin{align*}
ln(Demand_{i,t}) & \sim \operatorname{Normal}(\mu_{i,t}, \sigma) \\
\mu_{i,t} & \sim \bar\alpha + \gamma_{building[i]} + \delta_{year[t]} + \beta_1 \cdot ln(Price_{i,t}) +  \\
 & \quad \beta_{2} \cdot ln(Degree.days_{i,t}) + \beta_{3} \cdot ln(Heating.surface_{i,t}) + \\
 & \quad \beta_{4} \cdot Carrier.group.oil_{i,t} + \beta_{5} \cdot Carrier.group.district.heating_{i,t} + \\
 & \quad \beta_{6} \cdot ln(District.income_{i,t}) + \beta_{7} \cdot District.retire_{i,t} + \beta_{8} \cdot ln(Pop.density_{i,t}) + \\
 & \quad \beta_{9} \cdot ln(Price_{i,t}) \cdot Carrier.group.oil_{i,t} + \\
 & \quad \beta_{10} \cdot ln(Price_{i,t}) \cdot Carrier.group.district.heating_{i,t} \\
\bar\alpha & \sim \operatorname{Normal}(0, 1) \\
\gamma_j & \sim \operatorname{Normal}(0, \sigma_{\gamma}) \\
\delta_k & \sim \operatorname{Normal}(0, \sigma_{\delta}) \\
\beta_{1-10} & \sim \operatorname{Normal}(0, 0.5) \\
\sigma, \sigma_{\gamma}, \sigma_{\delta} & \sim \operatorname{Exponential}(1)
\end{align*}
```

Since the model represents an extension of the previous model, all notations remain the same. Only the additional interaction term between the main explanatory variable $ln(Price_{i,t})$ and the categorical energy carrier group is added. Because gas serves as the reference category, only terms for oil and district heating are added.

The Bayesian models are estimated using the brms-package by @burkner17 in R. The brms-package is an interface to the probabilistic programming language and inference engine Stan [@standevelopmentteam22].

## Descriptive Statistics {#descriptives}

After having established the workflow and empirical approach, the following part of the Chapter presents descriptive statistics on the full sample to obtain a better understanding of the data.

**Unbalanced occurrence of buildings**

How often an individual building is observed in the processed billing data (full sample) is shown in the histogram in Figure \@ref(fig:occurrence-buildings). Buildings are observed on average 6.77 times. The histogram shows that not all buildings are observed throughout the whole period under study, leading to the panel being unbalanced. While a relatively large number of buildings are observed only twice, the distribution exhibits a second peak at nine and ten times observed. This means that information on a relevant proportion of the buildings in the sample is available almost throughout the entire period.

```{r occurrence-buildings, echo = FALSE, fig.cap = "Histogram of the occurrence of buildings in the full sample", out.width = "75%", fig.align = "center"}
knitr::include_graphics(path = "figure/occurance_buildings.pdf")
```

**Spatial and temporal coverage of sample**

In addition, also the spatial and temporal distribution of observations in the sample is of relevance. Figure \@ref(fig:buildings-distribution) graphically depicts the spatial and temporal coverage of the full sample at the district level.[^41] The maps show that the coverage is good on the spatial dimension. There are very few districts without a building observed (transparent) and only a few districts with less than ten buildings observed per year (dark blue). For most district-year combinations, more than 100 buildings are observed. In some cities, numbers of more than 10,000 buildings annually are reached (e.g., Berlin). The good spatial coverage of the data indicates that results drawn from the sample have validity for Germany as a whole and are in their explanatory power not limited to certain regions or clusters.

[^41]: Please note the use of the logarithmic scale in Figure \@ref(fig:buildings-distribution).

On the temporal dimension, fewer observations are available in 2007 (43,696 observations) and 2008 (43,536 observations), as the energy price data was first introduced in these years. Between 2009 and 2019, an annual minimum of 201,856 and an average of 239,183 buildings are observed. This means that the explanatory power of the results applies in particular to the period between 2009 and 2019. At the same time, exploratory testing of the data with and without consideration of the years 2007 and 2008 did not lead to a relevant change in the results implying that the elasticity estimates are applicable to the whole period under study.

```{r buildings-distribution, echo = FALSE, fig.cap = "Map of the spatial and temporal coverage of the observed buildings", out.width = "77%", fig.align = "center"}
knitr::include_graphics(path = "figure/buildings_distribution.pdf")
```

**Summary statistics**

Table \@ref(tab:summary-statistics) provides summary statistics for the full sample reporting the median values and the interquartile range (IQR). In addition to an overall column, separate columns for the three energy carrier groups gas, oil and district heating, are also provided. About 60.6% of the observations in the sample are associated with gas as the energy carrier. A further 29.5% with oil and 9.9% with district heating. For space heat demand, as the response variable, the median value (IQR) for the sample overall is 113 (86, 145) kWh/sqm/y, and for energy price, as the main explanatory variable, the median (IQR) of the sample is 6.49 (5.77, 7.69) Cents/kWh. In terms of energy demand and price, there are pronounced and relevant differences between the three types of energy carriers. The average demand for gas and oil is higher than for district heating. The prices for gas are the lowest with relatively small variation. Prices for oil are slightly higher, but show greater variation. Prices for district heating are by far higher and also show the greatest variation.

\begin{table}[]
\centering
\caption{Summary statistics for full sample}
\label{tab:summary-statistics}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}llllll@{}}
\toprule
Variable {[}Median (IQR){]} &
  Unit &
  \begin{tabular}[c]{@{}l@{}}Overall\\ N = 2,718,246\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Gas\\ N = 1,647,563 (60.6\%)\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Oil\\ N = 802,451 (29.5\%)\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}District heating\\ N = 268,232 (9.9\%)\end{tabular} \\ \midrule
                                         &                 &                      &                      &                      &                      \\
Space heating demand                  & {[}kWh/sqm/y{]}   & 113 (86, 145)        & 116 (89, 149)        & 117 (91, 148)        & 83 (63, 109)         \\
Energy price, real                       & {[}Cents/kWh{]} & 6.49 (5.77, 7.69)    & 6.18 (5.56, 6.79)    & 7.06 (6.08, 8.25)    & 10.12 (8.71, 11.84)  \\
                                         &                 &                      &                      &                      &                      \\
Degree days                              &                 & 3,446 (3,214, 3,733) & 3,418 (3,192, 3,697) & 3,536 (3,273, 3,826) & 3,397 (3,191, 3,642) \\
Heating surface                          & {[}sqm{]}       & 404 (260, 707)       & 424 (271, 701)       & 305 (226, 466)       & 1,118 (556, 2,118)   \\
Housing units                            &                 & 6 (3, 10)            & 6 (3, 10)            & 4 (3, 6)             & 16 (8, 32)           \\
                                         &                 &                      &                      &                      &                      \\
\begin{tabular}[c]{@{}l@{}}District per capita\\ household income\end{tabular} &
  {[}€/a{]} &
  20,695 (18,786, 22,568) &
  20,658 (18,731, 22,563) &
  21,098 (19,388, 22,861) &
  19,217 (17,667, 21,327) \\
District retirement share                & {[}\%{]}        & 0.207 (0.193, 0.220) & 0.209 (0.194, 0.222) & 0.205 (0.193, 0.216) & 0.210 (0.192, 0.230) \\
Postal code population density &
  \begin{tabular}[c]{@{}l@{}}{[}inhabitants/\\ sq. km{]}\end{tabular} &
  572 (217, 1,960) &
  662 (255, 2,121) &
  320 (149, 839) &
  2,053 (505, 4,821) \\ \midrule
\textit{Note: Median (IQR), No missings} &                 &                      &                      &                      &                      \\ \bottomrule
\end{tabular}%
}
\end{table}

In addition, the summary statistics show that the average building in the sample has a heating surface of about 400 square metres, with buildings where a district heating system is installed being about three to four times larger than buildings with gas or oil heating. The degree days for buildings with oil heating are a few percent higher than the sample average, which is consistent with the population density variable and suggests that oil heatings are mainly installed in rural areas. Furthermore, the population density variable also shows that district heating is mainly found in urban areas. To check for potential multicollinearity issues between the variables, Appendix \@ref(fig:correlation-plot) displays a matrix of Pearson's correlation coefficients. None of the observed correlations between the variables exceeds moderate values so one can rule out concerns about multicollinearity. Furthermore, the correlation matrix reveals that energy price negatively correlates with energy demand, indicating that the expected negative relationship is reflected in the data.

**In-depth focus on energy demand and energy prices**

Figure \@ref(fig:demand-descriptive-graph) provides a more detailed visual summary of the demand variable. The aggregated distribution of energy demand (see Panel A) shows that the lowest annual demand in the sample is around 25 kWh/sqm/y. The distribution peaks at just over 100 kWh/sqm/y and then declines gradually to very high demand values of up to 350 kWh/sqm/y. The differentiated display of the mean demand levels by energy carrier group and over time (see Panel B) reflects the previous findings. While the demands for gas and oil are on an almost similar higher level, demand in buildings with district heating is considerably lower. One significant contributor to this difference is likely that conversion losses in gas and oil heating systems occur during combustion in the boiler. For district heating, those combustion losses already occurred in the heat plant as well as for the heat transport [@verbraucherzentralenrw16]. Typical conversion losses of gas and oil boilers are between 10-20% of the primary energy demand. In addition, some of the difference in demand may also be attributable to the great difference in building size with buildings with district heating being considerably larger on average.[^1817]

[^1817]: Given the significance of the difference in demand, it was further scrutinised if the age of the building and the age of the heating system may deviate between gas and oil buildings on the one and buildings with district heating on the other hand. This information is available for about 15% of the observations from the additional Energy Performance Certificate (EPC) data mentioned earlier, the use of which was otherwise discarded for this thesis. The rationale for looking deeper into these two variables is that newer buildings and more recent heating systems can be expected to go along with lower energy demand. The comparison is provided in Appendix \@ref(tab:age-building-heating-system). It does not find differences between the energy carrier groups of a magnitude that would suggest an additional strong argument for varying demand levels.

```{r demand-descriptive-graph, echo = FALSE, fig.cap = "Distribution and trend of energy demand", out.width = "100%", fig.align = "center"}
knitr::include_graphics(path = "figure/demand_descriptive.pdf")
```

Furthermore, two additional trends can be identified for the demand variable (see Panel B). First, the effective demand decreases over time. While this may be due to changes in the determinants of energy demand, it may also be that newer, more energy-efficient buildings are added to the sample while others drop out. Thus, this provides additional grounds for why controlling for the building and time dimension appears necessary. Second, while the overall demand level is decreasing, the development for all carrier types follows a similar pattern, with year-to-year demand being subject to fluctuations. In Appendix \@ref(fig:degree-days-distribution), the distribution of degree days is depicted on a spatial and temporal scale. A comparison of the temporal trends in degree days and energy demand indicates a concurrent pattern supporting the assumption that higher degree days (lower outdoor temperatures) lead to higher energy demand. This observation suggests that controlling for climatic conditions appears warranted as a strongly fluctuating determinant of space heating demand.

In Figure \@ref(fig:price-descriptive-graph) below, the distribution of nominal (Panel A) and real (Panel B) energy prices as well differentiated by energy carrier group are depicted. The annual points represent average prices. The vertical bars represent one standard deviation (SD). While the energy prices for gas are relatively stable over the period under investigation, oil prices show considerable volatility. As established previously, prices for district heating are higher than those for gas and oil (cf. Table \@ref(tab:summary-statistics)). Furthermore, the prices for district heating are not as volatile but show a much wider range of variation, which is reflected in the width of the SD bars.

```{r price-descriptive-graph, echo = FALSE, fig.cap = "Trend of nominal and real energy prices", out.width = "100%", fig.align = "center"}
knitr::include_graphics(path = "figure/prices_descriptive.pdf")
```

While nominal prices are relatively stable in the overall trend over time for all three energy carrier groups, the direction of the trend changes after adjusting for inflation. The deflated real prices show declining energy prices over the period under study, with the trend being more pronounced for gas and oil. For the intuition regarding the price elasticity of space heating demand, this means that one would expect an overall increase in demand due to the price effect assuming all other variables remain constant. However, the graph also shows that effects in both directions can be observed if one does not look at the overarching trend but the year-to-year movements in energy prices. After having described the underlying data in detail, the following Chapter moves on to present the results of the regression analysis.
