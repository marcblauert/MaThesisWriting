<!--
Chapter 3 - Methods
-->

```{r setup3, echo=FALSE}
pacman::p_load(tidyverse, thesisdown, knitr, kableExtra)

# Set how wide the R output will go
options(width = 70)
```

# Methods {#methods}

## Data and processing {#data}

In order to transfer the theoretical model set up in Section \@ref(conceptual-model) into a statistical model that can be used to empirically investigate the price elasticity of space heating demand, data from various sources were combined and processed.

**Energy billing data**

The key dataset in this process is a large-scale building-level panel of energy bills made available though the Climate Policy Department at DIW Berlin. The data originates from the energy- and billing service provider ista Deutschland GmbH and was provided for scientific use.[^31] The sample contains information on multi-unit residential buildings in Germany and ranges from 2003 to 2019. The smallest buildings observed have two living units; single-family houses with just one unit are not observed. The observations in the dataset represent annual heating bills at the building-level. The dataset contains the two main variables for the analysis: space heating demand and energy prices. It also contains additional building-level information on the heating surface, the energy carrier, and a building ID and the billing dates to create a panel data structure. While the demand data is available from the start, energy prices are first observed in 2007. Thus, the time period analysed in this thesis ranges from 2007 to 2019.

[^31]: Due to the sensitivity of the data, it is to be classified as confidential. Access was exclusively via DIW Berlin's internal servers. Due to data protection regulations, it is not possible to make the data available to external parties for the purpose of reproducing the results.

**Space heat demand (kWh/sqm/a):** The demand data in the billing dataset is provided as total energy consumed per building and per annual billing period in kilowatt hours (kWh). To isolate the share of energy consumed for the key purpose of space heating, the share of energy used for hot water production is deduced for those buildings where hot water production is also done via the central heating system. In a second step, in order to obtain a comparable metric for the differently sized buildings in the sample, the total space heating demand at building level is divided by the building heating surface in square meters (sqm). This results in the annual space heat demand per square meter as the demand variable. For a summary of the variables and their data sources see Table \@ref(tab:variables).

**Energy prices (Cents/kWh):** The structure of the price data in the dataset is similar to that of energy demand. Total annual costs in Euros are given at the building-level. Based on the relative consumption shares for space heating and hot water generation, the share of space heating in the total costs can be isolated. In a second step, the proportional costs for space heating is converted into per-unit costs by dividing them by the respective amount of space heating consumed in kWh. To make the cost scale more intuitive, it is transferred from Euros to Cents. This gives a per-unit cost in Cents per kWh. A breakdown according to fixed and variable cost components is not reported in the data. Additionally, energy prices are provided in nominal prices thus in order to obtain real prices, nominal prices are deflated using the German annual consumer price index (CPI) with 2015 as the index year [@destatis21].

**(Billing) Year:** The billing data contains the exact dates of the billing period of an individual building. While most billing periods mirror the calendar year, some buildings have billing periods occurring during the year. Therefore, the start and end dates of the billing periods are used to make an allocation to billing years. For billing periods during the year, the allocation is based on which of the two calendar years contains the majority of days in the billing period.

**Energy carrier:** There are three main groups of energy sources included in the data: Gas, Oil and District Heating. In order to obtain these three overarching categories, the individual energy source descriptions from the original data set are combined under these categories. In addition, all buildings with other heating sources whose occurrence is insignificant compared to the other three categories (e.g. electricity, coal combustion) are grouped under the category *Others*, which is later excluded from the analysis due to the heterogeneity of the group.

**Heating surface (sqm):** Information on the heating surface of a building is given as square meters at building level. The heating area does not correspond to the total floor area of a building, as it excludes the unheated areas within the buildings (e.g., building corridors or basements).

\begin{table}[]
\centering
\caption{Variables and data sources}
\label{tab:variables}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}lllll@{}}
\toprule
\textbf{Variable} & \textbf{} & \textbf{Type} & \textbf{Unit} & \textbf{Data source} \\ \midrule
 &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Demand\\ \end{tabular}} & Space heat demand & Continuous & ln(kWh/sqm) & Ista (billing data) \\
\textit{} &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Price\\ \end{tabular}} & Energy price & Continuous & ln(Cents/kWh) & Ista (billing data)\\
\textit{} &  &  &  &  \\
\multirow{4}{*}{\textit{\begin{tabular}[c]{@{}l@{}}Additional billing \\information\\ \end{tabular}}} & Heating surface & Continuous & ln(sqm) & Ista (billing data)\\
 & Energy carrier & Categorical & Gas / Oil / District heating & Ista (billing data)\\
 & Building ID & Categorical & - & Ista (billing data)\\
 & Year & Categorical & - & Ista (billing data)\\
\textit{} &  &  &  &  \\
\multirow{3}{*}{\textit{\begin{tabular}[c]{@{}l@{}}EPC data\\ \end{tabular}}} & Construction year & Continuous & - & Ista (EPC data) \\
 & Heating system installation year & Continuous & - & Ista (EPC data) \\
 & Renovation & Categorical & - & Ista (EPC data) \\
\textit{} &  &  &  &  \\
\textit{\begin{tabular}[c]{@{}l@{}}Climatic conditions\\ \end{tabular}} & Degree days & Continuous & ln(degree days) & IWU (2021) \\
\textit{} &  &  &  &  \\
\multirow{3}{*}{\textit{\begin{tabular}[c]{@{}l@{}}Socio-economic factors\\ \end{tabular}}} &  District household income & Continuous & ln(Euros/a) & Statistische Ämter (2021) \\
 & District retirement share & Continuous & \% & DESTATIS (2021) \\
 & Postal code population density & Continuous & ln(inhabitants/sq. km) & DESTATIS (2021) \\ \bottomrule
\end{tabular}%
}
\end{table}

\ 

**Supplementary data sources**

**Degree days:** Degree days were retrieved from an tool compiled by the *Institut für Wohnen und Umwelt (IWU)* at the postal code level [@iwu21]. The degree days data from the IWU-tool builds on daily temperature data from the 800 weather stations of the German Meteorological Service (DWD) that are aggregated on a monthly basis. Within the Excel-based tool, the settings of a mean room temperature of 20°C and a heating limit of 15°C are chosen to reflect the VDI based definition of degree days [@vdi13]. In addition, an assignment of the postal code area to the three nearest DWD weather stations with weighting according to geographical distance is chosen in order to better take into account possible distortions due to differences in altitude between a single weather station and the centroid of a postal code area. The extracted monthly degree day figures per postal code area are then aggregated to annual periods on a rolling basis and matched with the annual building-level energy billing observations. The postal code level was chosen because it corresponds to the spatial information on the location of the buildings contained in the billing data and therefore represents the most accurate allocation possible.

**District household income (Euros/a):** As district income the per capita disposable income of private households per person provided by the joint statistical portal of the federal and state governments is used [@statistischeamter21]. The figure comprises the primary income of private households, deducting transfers paid and adding transfers received. Disposable income is chosen because it can be considered the most suitable indicator for funds available for households. The district-level is chosen as it is the most granular household income statistics available.

**District retirement share (%):** To construct the district retirement share variable, population data at the district level with a segmentation by age groups is used [@destatis21c]. As an approximation for the actual proportion of retirees, the percentage of persons within a district and year who are older than 65 years is calculated. This approach was chosen because no detailed statistics are available on the number of people in retirement at the district-level.

**Postal code population density (inh./sq. km):** To generate the population density variable, data from Open Street Maps with pre-assigned population figures to post code areas based on the 2011 Census were used [@osm21; @osm21a]. The postal code and not the district level was chosen because, firstly, a higher granularity of data was available and, secondly, the use of districts as the level of analysis would have obscured much of the heterogeneity within districts. To calculate population density, the number of inhabitants per postal code was divided by the base area in square kilometers (sq. km).

## Estimation methods and empirical model {#empirical_model}

**Establishing causality**

**Endogeneity issues**


Prices: Form nominal --> real


There is considerable debate in the literature whether household energy demand depends on the marginal or average price, which may differ in the presence of fixed fee and block pricing. Shin (1985) argues that households will respond to average price, which is easily calculated from the electricity bill, rather than to the actual block marginal price, which is costly to determine, and develops an empirical strategy for testing this conjecture. The average price is also used in Metcalf and Hassett (1999),5 and Borenstein (2008, 2009) and Ito (2010) find no evidence that consumers “bunching up” around the block where the price changes, as one would expect if consumers truly respond to marginal price. If demand is assumed to depend on the marginal block price, then price and consumption are simulta-neously determined, and instrumental variable estimation techniques must be used (Burtless and Hausman, 1978; McFadden et al., 1978; Wilder and Willenborg, 1975; Hewitt and Hanemann, 1995; Reiss and White, 2005).
For lack of exact information about the block rates faced by the consumers, however, we are forced to use average price. 


Zu Blockpreisen:
Blockpreise stellen eine gesonderte Ausprägungsform von Paketpreisen dar, und sind beispielsweise bei Stromlieferanten vorzufinden (ebd.). Hier ändern sich die Preise je Mengenintervall, d.h. im Beispiel der Stromversorger nimmt der Preis mit steigendem Mengenintervall ab. Die Idee dahinter ist die, dass die Nachfrage nach Energieversorgung zwar mit zunehmender Haushaltsgröße steigt, die Zahlungsbereitschaft für die gewünschte Menge beim Ausgangspreis jedoch sinkt, sodass durch Blockpreise dieses Dilemma ausgeglichen werden kann und somit zusätzliche Gewinne generiert werden können (ebd., S.288).

Aus Alberini (2011):
An additional concern is whether usage decisions depend on the price in the current (billing) period, on that of earlier periods, or a moving average of the prices of recent periods (Poyer and Williams, 1993).For good measure, in what follows we experiment with current price, as well as price of the previous period.


**Frequentist estimation approaches**

In line with the previous literature [@meier_rehdanz10; @schmitz_madlener20], the fixed-effects model takes the following form:

```{=tex}
\begin{equation}
ln(D)_{it} = \alpha + \beta ln(P)_{it} + \gamma X_{it} + \delta_i + \eta_t + \varepsilon_{it}
(\#eq:fixedeff)
\end{equation}
```


With a panel data set, the same units are sampled in two or more time periods. For each unit (individual, school, city, and so on) i we have multiple years of data

Main benefit of panel data: with multiple years of data we can control for unobserved characteristics that do not change (or change slowly) over time. Very useful for policy analysis

Econometric methods extend to unbalanced panels, and software takes care of algebraic details

However, one should ask: Why are some periods missing for some units? (For example, is reporting achievement scores by schools optional or not enforced?)

An unbalanced panel (e.g., the second dataset above) is a dataset in which at least one panel member is not observed every period. Therefore, if an unbalanced panel contains N panel members and T periods, then the following strict inequality holds for the number of observations (n) in the dataset: n < N×T.

individuals observed in multiple time periods



**Bayesian estimation approaches**

## Workflow {#workflow}

**ADD CORRECT VERSIONS OF WORKFLOW LATER**

In Figure \@ref(fig:workflow1) the first part of the workflow of the empirical analysis is depicted. The upper part describes the data processing and the merging of data. The bottom part shows the regression analyses performed on the full sample using ordinary least squares (OLS) and fixed effects (FE) regressions. In Figure \@ref(fig:workflow1) the second part of the workflow is shown. After using Frequentist estimation techniques on the full sample, the analysis moves to the application of Bayesian regression analysis. For this purpose, a random sub-sample is created for which also the information from the energy performance certificates (EPC) is available. Additionally, the sub-sample is used to investigate potential factors of heterogeneity within the sample.

**Full sample: Data processing and matching**

The energy billing data requires several steps of data processing to clean the data, which are shown in the upper part of Figure \@ref(fig:workflow1). After the data cleaning, 2,719,270 of the original 4,494,943 annual billing observations (60.5%) remain for the full sample analysis. The criteria applied in the cleaning process are ordered by their relevance (number of observations removed).

```{r workflow1, echo = FALSE, fig.cap = "Workflow of data processing and full sample analysis", out.width = "103%", fig.align = "center"}
knitr::include_graphics(path = "figure/workflow_diagramm_1.pdf")
```

The most important reason for exclusion from the sample is the absence of price data. In the period 2003-2006, price data are not available for any of the observations. This leads to the exclusion of 909,458 observations. In addition, price data are also missing for a part of the observations in the period 2009-2019. Due to these gaps in the price data, a further 543,544 observations are excluded from the dataset. A further 233,888 observations are removed from the sample because they are associated with buildings that occur only once in the sample. The decision to apply this criterion was mainly due to the fact that singular building IDs occurred mainly in the period 2007-2008, suggesting that IDs from this period are not linked with observations in later periods. Furthermore, observing a building at least twice during the analysed period allowed for cross-validation of matching building attributes and therefore better reliability of the data. Another 53,674 observations were removed from the sample because the buildings are heated with an energy carrier other than gas, oil, or district heating. Due to the small number of buildings compared to the total sample size and due to the heterogeneity of the group (both very modern buildings with heat pumps and un-renovated buildings with coal heating), it was decided to exclude all other energy carriers from the sample. In addition, another 1,722 observations were excluded as duplicates (matching building ID and year) and 65 observations due to a deviating length of the billing period (deviation of more than +/- 10 days).

In addition to the rationales described above, there are two other reasons for excluding observations, both of which are related to outliers in the energy price data. Firstly, it was identified through exploratory testing that the price data contains fictitious cost values (e.g. 1,000.00 Euros for the entire building) that are used as placeholders and do not reflect the actual costs. These fictitious cost values arise because ista, as a billing service provider, does not always have information about the costs incurred by the building owners and therefore uses the placeholders for technical reasons. The actual costs are only entered later by the building owners and do not appear in the sample. This practice leads to the formation of outliers in the price data, as the fictitious cost values do not necessarily reflect the size and characteristics of a building. In total, 31,665 observations are removed due to fictitious cost values. In a second step, outliers in the price data were also excluded that either showed strong deviations from the reasonable price level for the period under observation (<2 cents/kWh or >100 cents/kWh) or strong price changes from one period to another (>10 or <-10 cents/kWh compared to the previous year). The exclusion thresholds were based on expert judgement and were chosen to ensure that only extremely unrealistic observations were included. This additional step excludes a further 1,717 observations from the sample. Compared to the other cleaning steps described before, the exploratory examination of the data showed that the two price-related reasons exerted a strong influence on the results of the analysis and therefore represent an important step in the analysis.

The processed billing data are then matched with the external data sources (see figure \@ref(fig:workflow1)). Due to missing degree days data or changes in the administrative areas, a further 1,940 observations are removed from the sample here, which ultimately leads to 2,719,270 remaining observations. After the processing, these observations are both complete and systematically checked for data errors that may have affected the outcome of the analysis.


**Full sample: Regression analysis**














## Notizen aus anderen Publikationen


Since we model conditional demand only, the results should be considered as short-term elasticities. In contrast, medium- and long-term income elasticities tend to be higher. Households with increased income are likely to move into larger homes over the medium term, which would increase their heating expenditures as well (Nesbakken 1999).  --> Short-run elasticities as a lower bar estimate that produces a conservative estimate.


Csereklyei (2020):
It is widely anticipated that responses in electricity consumption to changes in prices will be rather slow, as it takes time for energy-using durable stock to change (Miller and Alberini, 2016). Thus, short-run or annual price elasticity estimates are expected to be rather inelastic, while one anticipates significantly larger long-run estimates.

Miller and Alberini (2016) furthermore report that the use of IV estimates can change the reported elasticities by up to 80%.


All from Labanderira et al.

discrete decision to purchase durable goods that consume energy and the decision to consume energy is rarely considered. 
renovations may disturbe the picture the panel data provides

On the other hand, most empirical studies in this area have used single-equation econometric models that require separability re- strictions. This is a severe disadvantage as it is not possible to estimate cross-price effects between different energy products or consider the effects of non-energy products on the price elasticity of energy goods. 


Sample period. It is widely accepted that the economic cycle has a strong influence on energy consumption due to income and (indirect cycle-related) price effects. In the case of economic crises, for example, a depression of energy prices may occur; reduced dis- posable income may lead agents to reduce consumption through improvements in energy efficiency, adjustments to other types of consumption or changes towards other more inexpensive energy goods.


From Aufhammer wegen IV approach:
We instrument the utilities’ consumer-facing prices with the weekly average spot price of natural gas at a major natural gas distribution hub in Louisiana (the Henry Hub). This instrument is valid, as we know the formula of how utilities pass-through the price (providing a strong first stage), and the price is determined prior to within-bill consumption (strengthening the exclusion restriction).

No change in the energy taxation (Energiesteuergesetz) in the observed period; letzte Neufassung aus 2006 mit Effekten für 2007

Miller Alberini (2016):
We also find that aggregating our data can result in both higher and lower price elasticity estimates, depending on the dataset used, and that controlling for unit-level fixed effects with panel data generally results in more inelastic demand functions. Addressing the endogeneity of price and/or measurement error in price with instrumental variables has a small but noticeable effect on the price elasticities. Finally, controlling for housing characteristics and capital stock produces a lower price elasticity.
